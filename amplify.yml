version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            - nvm use 18
            - npm install -g pnpm@^8
            - cd ../..
            - rm -rf apps/frontend/.next/cache
            - pnpm install --virtual-store-dir apps/frontend/node_modules/.pnpm
        build:
          commands:
            - pnpm build
            - cd apps/frontend
            - env | grep -e NEXT_PUBLIC_ > .env.production
            - ./gen_env.sh production
        postBuild:
          commands:
            - ./minify.sh # minify the standalone folder to save space
            - rm -rf .next/cache
            - du -h -d2 .next

      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
    appRoot: apps/frontend
